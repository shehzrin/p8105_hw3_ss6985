---
title: "P8105 Homework 3"
author: "Shehzrin Shah"
date: "2024-10-12"
output: github_document
---

```{r setup, echo = FALSE, message = FALSE}
library(tidyverse)
library(p8105.datasets)
library(ggridges)
```

## Problem 1 

Loading the data from the `p8105.datasets` package: 
```{r}
data("ny_noaa")
summary(ny_noaa)
```

The dataset being explored is the `ny_noaa` dataset from the `p8105.datasets` package. It contains a total of `r nrow(ny_noaa)` rows and `r ncol(ny_noaa)` columns, representing daily weather observations from various locations in New York state. The columns include: 

  * `id`: a station identifier
  * `date`: the date of the observation 
  * `prcp`: precipitation (tenths of mm)
  * `snow`: snowfall (mm)
  * `snwd`: snow depth (mm)
  * `tmax`: maximum temperature (tenths of degrees C)
  * `tmin`: minimum temperature (tenths of degrees C)

Looking at the original dataset, we see it contains substantial amount of missing data (lots of `NA` values across variables as seen from data and `summary` command). There are  `r sum(is.na(ny_noaa))` missing values in the dataset. 

### Data cleaning: 
```{r}
noaatidy_df = ny_noaa |>
  janitor::clean_names() |>
  separate(date, into = c("year", "month", "day"), convert = TRUE) |>
  mutate(
    prcp = prcp / 10 ,
    tmax = as.numeric(tmax) / 10,
    tmin = as.numeric(tmin) / 10,
    year = as.numeric(year),
    day = as.numeric(day),
    month = recode_factor(month,
          "01" = "January",
          "02" = "February",
          "03" = "March",
          "04" = "April",
          "05" = "May",
          "06" = "June",
          "07" = "July",
          "08" = "August",
          "09" = "September",
          "10" = "October",
          "11" = "November",
          "12" = "December"
    ))
```
In the data cleaning step, we cleaned the variables names, created separate variables for year, month, and day, and converted these variables to numeric variables. Additionally, variables measured in tenths of units were converted into just units (e.g., `tmin` was measured in tenths of degrees C and converted into degrees C). 

```{r}
noaatidy_df |>
  filter(!is.na(snow)) |>            
  group_by(snow) |>                 
  summarize(count = n()) |>        
  arrange(desc(count)) 
```
For snowfall, the most commonly observed value is O (no recorded snowfall on most days in NY state). This makes sense because snowfall only occurs during certain times of the year and in specific conditions (i.e., there are many days with no snowfall, and a small window for possible snow). 


### Making two-panel plot:
```{r}
avg_temp_df = noaatidy_df %>% 
  filter(month %in% c("January", "July")) %>% 
  group_by(id, year, month) %>% 
  summarize(avg_tmax = mean(tmax, na.rm = TRUE))

ggplot(avg_temp_df, aes(x = year, y = avg_tmax, color = month)) +
  geom_point(alpha = 0.2) +
  geom_smooth(alpha = 0.5) +
  labs(
    title = "Average Maximum Temperature in January and July by Station",
    x = "Year",
    y = "Average Max Temperature (°C)",
  ) +
  scale_x_continuous(
    breaks = c(1980, 1985, 1990, 1995, 2000, 2005, 2010)
    ) +
  facet_grid(. ~ month) +
  viridis::scale_color_viridis(discrete = TRUE) +
  theme(
    legend.position = "none")
```
The two-panel plot shows the average maximum temperature in January and July across years by station. July temperatures remain stable around 25–30°C, with fewer outliers (e.g., one possible at about 14ºC), overall ranging from about 20ºC and 35ºC. Seasonal patterns are evident in January, while July shows less variation. January temperatures fluctuate more (within approximately -10 to 10ºC), with some potential outliers (e.g., lowest max temperature at about -14ºC). There does not appear to be a significant difference in average max temperatures in July or January throughout the years. The average temperatures in January (winter month) are also lower than in July (summer month).

### Making more two-panel plots: 
```{r}
tmax_tmin_df = noaatidy_df |>
  filter(!is.na(tmax), !is.na(tmin)) |>
  ggplot(aes(x = tmin, y = tmax)) +
  geom_hex(bins = 40) +
  geom_smooth(se = FALSE) +
  viridis::scale_color_viridis(discrete = TRUE) + 
  labs(
    title = "Maximum vs Minimum Temperatures",
    x = "Minimum Temperature (°C)",
    y = "Maximum Temperature (°C)"
  ) + 
  theme_minimal() + 
  theme(legend.position = "bottom")

tmax_tmin_df

snowfall_df = noaatidy_df |>
  filter(snow > 0, snow < 100) %>% 
  ggplot(aes(x = snow, y = factor(year), fill = stat(x))) +
  geom_density_ridges_gradient(scale = 3, rel_min_height = 0.01) + 
  scale_fill_viridis_c(name = "Snowfall (mm)", option = "A") + 
  labs(
    title = "Distribution of Snowfall (0 < Snow < 100) by Year",
    x = "Snowfall (mm)",
    y = "Year"
  )

snowfall_df
```

The first two-panel plot (hex plot) shows the `tmax` vs `tmin` for the full dataset. The plot shows denser regions at moderate maximum temperatures (around 0ºC to 35ºC) and minimum temperatures (around -10ºC to 20ºC), suggesting most observations fall within that range. 

The second two-panel plot shows the distribution of snowfall (values greater than 0 and less than 100) separately by year. The ridgeline plot shows distributions across years with most snowfall events concentrated around 0-40mm. The overall patterns suggests a fairly consistent distribution of snowfall values below 50mm even with some variability across the years. 


